# 项目开发记录与问题归纳（Q/A）

以下按时间顺序汇总本次开发过程中出现的 Bug、疑问与关键技术点。

## Q/A 列表
1. Q: DHT11 报错 `ETIMEDOUT`，是否是代码问题？
   A: 多数是硬件接线/上拉问题。裸 DHT11 无上拉电阻会超时，建议更换模块或补上拉。

2. Q: `ImportError: no module named 'hw_config'` 如何解决？
   A: 设备运行目录漂移导致导入失败。通过增加 `sys.path` 兜底路径或把文件放在根目录解决。

3. Q: Thonny 报 `name 'main' isn't defined` 是否影响运行？
   A: 不影响主循环本体，是 Thonny 执行方式提示。确保运行设备端文件即可。

4. Q: 非阻塞设计真的必要吗？
   A: 需要。阻塞式 `sleep` 会卡住上传/蓝牙等模块。改为时间片调度与缓存能提升稳定性。

5. Q: `wifi-disconnected` 连续出现是什么原因？
   A: 当时未开启热点或网络不可用。后续加入非阻塞重连与失败队列节流。

6. Q: 内存持续下降是否泄漏？
   A: 大量打印与失败队列堆积易导致碎片。通过节流入队、减少日志体积与定时 `gc.collect()` 缓解。

7. Q: BLE 无法被扫描到，是否是名称问题？
   A: 主要是广播间隔单位错误（微秒），并且缺少标准 Flags。修正后可被发现。

8. Q: WiFi 与 BLE 同时开启会影响扫描吗？
   A: 会。切到 BLE 时关闭 WiFi 能提高扫描稳定性。

9. Q: KEY1 引脚如何调整？
   A: 从 GPIO4 改为 GPIO14，并在配置文件中统一管理。

10. Q: Thonny 执行 `exec(open(...))` 会引发 WDT？
    A: 可能造成重复加载与看门狗触发，建议使用根目录 `main.py` 统一入口。

11. Q: 桌面端 Electron 安装很慢是否正常？
    A: Electron 体积大，下载慢。建议使用镜像源并避免中断安装。

12. Q: npm 报执行策略/删除失败如何处理？
    A: Windows PowerShell 需调整执行策略或用 CMD；删除用 `Remove-Item` 或 `rmdir`。

13. Q: BLE 桥接与桌面端如何连接？
    A: 使用 Python bleak + WebSocket 与 Electron 通信，BLE 名称或 NUS UUID 过滤。

14. Q: Git 提交如何保护敏感信息？
    A: 将 `hardware/hw_config.py` 加入 `.gitignore`，提交模板 `hw_config.sample.py`。

15. Q: 运行时 WiFi 配网如何持久化？
    A: 使用 `hw_runtime_config.py` 保存到 `runtime_config.json`（已忽略 Git）。

16. Q: BLE 连接后为何长时间无数据？
   A: 只有完成 BLE 连接后才开始 notify。增加配对日志与未连接提示后更容易确认状态。

17. Q: BLE 写入只收到 `{"type": "wifi", "ss` 片段？
   A: BLE 写入默认 20 字节分包，需在桌面端分片发送并在设备端缓冲拼包。

18. Q: `unexpected keyword argument 'timeout'` 如何解决？
   A: MicroPython 的 `urequests` 不支持 `timeout` 参数，改为 `socket.setdefaulttimeout()`。

19. Q: WiFi 仍显示断开但热点已开启？
   A: `hw_config.py` 中 SSID/密码若是空格会被当作有效值，需 `strip()` 或填写真实值。

20. Q: 运行时配置读写是否兼容 MicroPython？
   A: `open(..., encoding="utf-8")` 在部分固件不兼容，已移除 `encoding`。

21. Q: BLE 断开后出现 `ENODEV`？
   A: 断开后重新广播时增加异常保护，避免崩溃。
